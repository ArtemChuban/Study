Классификация протоколов:
- Протоколы с использованием ассиметричной или симметричных систем шифрования
- Протоколы передачи (уже сгенерированных) ключей
- Протоколы (совместной) выработки общего ключа (открытое распределение ключей)
- Схемы предварительного распределения ключей

# 1. Передача ключей с использованием симметричного шифрования
1. $A \rightarrow B: E_{kAB}(k, t, id(A), id(B))$
2. 
	0. $A \rightarrow B: id(A)$
	1. $B \rightarrow A: r_{B}$
	2. $A \rightarrow B: E_{kAB}(k, r_{B}, id(B))$
3. 
	0. $A \rightarrow B: id(A)$
	1. $B \rightarrow A: r_{B}$
	2. $A \rightarrow B: k \oplus h_{kAB}(r_{B}, id(A), id(B))$

Протокол для передачи ключа, который генерируется обоими сторонами
0. $A \rightarrow B: id(A)$
1. $B \rightarrow A: r_{B}$
2. $A \rightarrow B: E_{kAB}(k_{A}, r_{A}, r_{B}, id(B))$
3. $B \rightarrow A: E_{kAB}(k_{B}, r_{B}, r_{A}, id(A))$

$k = f(k_{A}, k_{B})$

Трехсторонние протоколы
1. $A \rightarrow T: id(A), id(B), r_{A}$
2. $T \rightarrow A: E_{kAT}(r_{A}, id(B), k, E_{kBT}(k, id(A)))$
3. $A \rightarrow B: E_{kBT}(k, id(A))$
4. $B \rightarrow A: E_{k}(r_{B})$
5. $A \rightarrow B: E_{K(r_{B} - 1)}$

$T$ - доверенный центр (третья сторона)

Трехсторонний протокол взаимной аутентификации (идентификации)
1. $A \rightarrow B: r, id(A), id(B), E_{kAT}(r_{A}, r, id(A), id(B))$
2. $B \rightarrow T: r, id(A), id(B), E_{kAT}(r_{A}, r, id(A), id(B)), E_{kBT}(r_{B}, r, id(A), id(B))$
3. $T \rightarrow B: E_{kAT}(r_{B}, k), E_{kBT}(r_{A}, k)$
4. $B \rightarrow A: E_{kAT}(r_{A}, k)$
5. $A \rightarrow B: E_{k}(r_{A}, r_{B})$
6. $B \rightarrow A: E_{k}(r_{A})$

# 2. Передача ключей с использованием асимметричного шифрования
Протоколы без использования ЭЦП
1. $A \rightarrow B: E_{pkB}(k, t, id(A))$
2. Взаимная аутентификация и подтверждение получения ключа
	1. $A \rightarrow B: E_{pkB}(k_{1}, id(A))$
	2. $B \rightarrow A: E_{pkA}(k_{1}, k_{2})$
	3. $A \rightarrow B: E_{pkB}(k_{2})$

Протокол с использованием цифровой подписи
1. $A \rightarrow B: E_{pkB}(k, t, id(A), S_{A}(id(B), k, t))$ (Шифрование подписанного ключа)
2. $A \rightarrow B: E_{pkB}(k, t, id(A)), S_{A}(id(B), k, t)$ (Отдельное шифрование и подпись)
3. $A \rightarrow B: t, E_{pkB}(id(A), k), S_{A}(id(B), t, E_{pkB}(id(A), k))$ (Подпись зашифрованного ключа)

###### Сертификаты открытых ключей
Как правило, при использовании открытых ключей, хранят не сами ключи, а их сертификаты. Сертификат представляет собой набор данных, состоящий из идентификатора $A$, его открытого ключа $pkA$, времени выдачи сертификата и срока его действия $t$, все это еще заверяется цифровой подписью доверенного центра.

Сертификат предназначен для исключения возможности подмены открытого ключа при его хранении или пересылке.

$C_{A} = (id(A), pkA, t, S_{TA}(id(A), pkA, t))$

Международный стандарт X.509 определяет следующий протокол аутентификации:
1. $A \rightarrow B: C_{A}, D_{A}, S_{A}(D_{A})$
2. $B \rightarrow A: C_{B}, D_{B}, S_{B}(D_{B})$
3. $A \rightarrow B: r_{B}, id(B), S_{A}(r_{B}, id(B))$

$C_{A} = (id(A), pkA, t, S_{kTA}(id(A), pkA, t))$

$C_{B} = (id(B), pkB, t, S_{kTB}(id(B), pkB, t))$

$C_{A}, C_{B}$ - сертификаты сторон

$D_{A} = (t_{A}, r_{A}, id(B), data_{A}, E_{pkB}(k_{1}))$

$D_{B} = (t_{B}, r_{B}, id(A), data_{B}, E_{pkA}(k_{2}))$

# 3. Открытое распределение ключей
Открытое распределение ключей позволяет двум абонентам вырабатывать общий секретный ключ путем динамического взаимодействия на основе обмена открытыми сообщениями без какой-либо секретной информации, распределяемой заранее.

Преимущество: ни один из абонентов заранее не может определить значение ключа, так как ключ зависит от передаваемых сообщений.

Протокол Диффи-Хеллмана

Общие параметры сети:
- $p$ - большое простое число
- $\alpha \in Z_{p}^{*} = \{1, 2, \dots, p - 1\}$ ($\alpha$ - образующий элемент группы)

$x, y$ - случайный числа ($1 < x, y < p - 1$)

1. $A \rightarrow B: \alpha^{x} \mod p$
2. $B \rightarrow A: \alpha^{y} \mod p$

Общий ключ

$k = (\alpha^{y})^{x} \mod p = (\alpha^{x})^{y} \mod p$

Атака на протокол "Злоумышленник посередине" (злоумышленник имеет возможность подмены)

Усовершенствованный протокол Диффи-Хеллмана (STS)
1. $A \rightarrow B: \alpha^{x} \mod p$
2. $B \rightarrow A: \alpha^{y} \mod p, E_{k}(S_{skB}(\alpha^{y}, \alpha^{x}))$
3. $A \rightarrow B: E_{k}(S_{skA}(\alpha^{x}, \alpha^{y}))$